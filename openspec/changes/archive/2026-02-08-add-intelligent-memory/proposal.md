# 提案：添加智能记忆功能

## Why（为什么要做）

目前，nanobot 只有被动记忆机制 - 它可以读取 `MEMORY.md` 和每日笔记文件，但缺少自动记忆创建和总结功能。所有对话历史都以 JSONL 格式存储，但从未自动总结。用户必须手动指示 AI 记录重要信息，这种方式效率低下且容易出错。

此变更通过实现自动对话总结、智能信息提取和持久化每日概要来解决这个问题。用户将无需手动干预即可获得自动记忆创建。

## What Changes（变更内容）

- 在对话结束后添加自动每日对话总结
- 实现关键信息的智能提取（话题、偏好、决定、任务、技术问题）
- 创建 Markdown 格式的结构化每日概要文件
- 基于提取的洞察实现自动长期记忆更新
- 添加记忆去重功能以避免记录重复信息
- 提供可配置的触发机制（基于消息数量）

## Capabilities（能力）

### New Capabilities（新增能力）

- `daily-conversation-summary`：自动生成每日对话的结构化概要，提取话题、用户偏好、重要决定、任务和技术问题
- `smart-memory-update`：基于对话洞察智能评估和更新长期记忆，具有重要性评分和去重功能

### Modified Capabilities（修改的能力）

无（这是一个新功能，不修改现有规范级别的行为）

## Impact（影响范围）

- **新增模块**：`nanobot/agent/conversation_summarizer.py`、`nanobot/agent/memory_updater.py`
- **修改代码**：`nanobot/agent/loop.py`（集成点）
- **新工作流**：对话结束 → 自动总结 → 每日概要 → 长期记忆更新
- **面向用户的变更**：自动创建每日概要文件，改进记忆上下文
- **配置**：可选的环境变量用于控制总结触发频率
- **依赖项**：无新的外部依赖（使用现有的 LLM 提供商和工具）
